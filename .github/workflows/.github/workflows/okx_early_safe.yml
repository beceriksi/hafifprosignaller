name: OKX Early+Safe Scanner

on:
  workflow_dispatch: {}
  schedule:
    - cron: "*/5 * * * *"   # her 5 dakikada bir (GitHub, 1-2 dk'yı garanti etmez)

jobs:
  scan:
    runs-on: ubuntu-latest
    timeout-minutes: 12

    env:
      # === TELEGRAM ===
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      CHAT_ID:        ${{ secrets.CHAT_ID }}

      # === TARAMA AYARLARI (gerekirse değiştir) ===
      TOP_N:           "80"        # OKX en çok işlem gören ilk N USDT parite
      VOL_MIN_EARLY:   "150000"    # erken uyarı için en az 1 dakikalık USDT hacmi
      VOL_MIN_CONF:    "250000"    # onay için en az 1 dakikalık USDT hacmi
      VRATIO_EARLY:    "3.0"       # son 1m hacim / EMA(15) eşiği (erken)
      VRATIO_CONF:     "3.5"       # son 1m hacim / EMA(15) eşiği (onay)
      MOM_1M_MIN:      "0.0045"    # ≈ +0.45% (erken ivme)
      PULLBACK_MIN:    "0.0025"    # ≈ -0.25% (onay geri çekilme alt sınır)
      PULLBACK_MAX:    "0.0080"    # ≈ -0.80% (onay geri çekilme üst sınır)
      RSI5_CONF_MIN:   "53.0"      # 5m RSI alt sınır (onay)
      MAX_MSG_COINS:   "10"        # tek mesajda max satır

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run scanner
        run: python main.py
